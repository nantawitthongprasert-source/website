<!doctype html>
<html lang="th" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ß‡∏±‡∏ô</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Prompt', sans-serif;
    }
    .glass-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
    }
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      transition: all 0.3s ease;
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
    }
    .btn-success {
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    }
    .btn-danger {
      background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
    }
    .status-pending {
      background: linear-gradient(135deg, #f5af19 0%, #f12711 100%);
    }
    .status-approved {
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    }
    .status-rejected {
      background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
    }
    .input-field {
      transition: all 0.3s ease;
      border: 2px solid #e2e8f0;
    }
    .input-field:focus {
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
    }
    .fade-in {
      animation: fadeIn 0.5s ease-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .toast {
      animation: slideIn 0.5s ease-out;
    }
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    .card-hover {
      transition: all 0.3s ease;
    }
    .card-hover:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }
    .nav-item {
      position: relative;
      transition: all 0.3s ease;
    }
    .nav-item::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 50%;
      width: 0;
      height: 2px;
      background: #667eea;
      transition: all 0.3s ease;
      transform: translateX(-50%);
    }
    .nav-item:hover::after,
    .nav-item.active::after {
      width: 100%;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full gradient-bg">
  <div id="app" class="h-full overflow-auto"><!-- Toast Notification -->
   <div id="toast" class="fixed top-4 right-4 z-50 hidden">
    <div class="glass-card rounded-xl px-6 py-4 shadow-2xl flex items-center gap-3"><span id="toast-icon" class="text-2xl">‚úÖ</span> <span id="toast-message" class="font-medium text-gray-800"></span>
    </div>
   </div><!-- ÔøΩÔøΩ‡∏ô‡πâ‡∏≤ Login -->
   <div id="login-page" class="min-h-full flex items-center justify-center p-4">
    <div class="glass-card rounded-3xl shadow-2xl p-8 w-full max-w-md fade-in">
     <div class="text-center mb-8">
      <div class="w-20 h-20 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg"><span class="text-4xl">üè´</span>
      </div>
      <h1 id="school-name-display" class="text-2xl font-bold text-gray-800 mb-2">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</h1>
      <p id="system-title-display" class="text-gray-600">‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ß‡∏±‡∏ô</p>
     </div><!-- Tab ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ -->
     <div class="flex bg-gray-100 rounded-xl p-1 mb-6"><button id="tab-student" onclick="switchLoginTab('student')" class="flex-1 py-3 rounded-lg font-medium transition-all bg-white shadow text-purple-600"> üë®‚Äçüéì ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô </button> <button id="tab-teacher" onclick="switchLoginTab('teacher')" class="flex-1 py-3 rounded-lg font-medium transition-all text-gray-500"> üë®‚Äçüè´ ‡∏Ñ‡∏£‡∏π/‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£ </button>
     </div><!-- ‡∏ü‡∏≠‡∏£‡πå‡∏° Login ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô -->
     <form id="student-login-form" onsubmit="handleStudentLogin(event)" class="space-y-4">
      <div><label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label> <input type="text" id="student-id-input" placeholder="‡πÄ‡∏ä‡πà‡∏ô 12345" class="input-field w-full px-4 py-3 rounded-xl outline-none" required>
      </div>
      <div><label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô 4 ‡∏ï‡∏±‡∏ß‡∏ó‡πâ‡∏≤‡∏¢</label> <input type="password" id="student-id-card" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1234" maxlength="4" class="input-field w-full px-4 py-3 rounded-xl outline-none" required>
      </div><button type="submit" class="btn-primary w-full py-4 rounded-xl text-white font-semibold text-lg shadow-lg"> ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö </button>
      <p id="student-login-error" class="text-red-500 text-sm text-center hidden"></p>
     </form><!-- ‡∏ü‡∏≠‡∏£‡πå‡∏° Login ‡∏Ñ‡∏£‡∏π -->
     <form id="teacher-login-form" onsubmit="handleTeacherLogin(event)" class="space-y-4 hidden">
      <div><label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label> <input type="text" id="teacher-username" placeholder="username" class="input-field w-full px-4 py-3 rounded-xl outline-none" required>
      </div>
      <div><label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label> <input type="password" id="teacher-password" placeholder="password" class="input-field w-full px-4 py-3 rounded-xl outline-none" required>
      </div><button type="submit" class="btn-primary w-full py-4 rounded-xl text-white font-semibold text-lg shadow-lg"> ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö </button>
      <p id="teacher-login-error" class="text-red-500 text-sm text-center hidden"></p>
      <div class="text-center text-sm text-gray-500 mt-4 p-3 bg-gray-50 rounded-lg">
       <p class="font-medium mb-1">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ó‡∏î‡∏™‡∏≠‡∏ö:</p>
       <p>Username: <span class="font-mono bg-gray-200 px-2 py-1 rounded">admin</span></p>
       <p>Password: <span class="font-mono bg-gray-200 px-2 py-1 rounded">1234</span></p>
      </div>
     </form>
    </div>
   </div><!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô -->
   <div id="student-page" class="min-h-full hidden"><!-- Header -->
    <header class="glass-card sticky top-0 z-40 px-4 py-3 shadow-lg">
     <div class="max-w-4xl mx-auto flex items-center justify-between">
      <div class="flex items-center gap-3"><span class="text-2xl">üéì</span>
       <div>
        <p class="font-semibold text-gray-800" id="student-welcome">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ</p>
        <p class="text-sm text-gray-500" id="student-id-display">‡∏£‡∏´‡∏±‡∏™:</p>
       </div>
      </div><button onclick="logout()" class="px-4 py-2 rounded-lg bg-red-100 text-red-600 font-medium hover:bg-red-200 transition-all"> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö </button>
     </div>
    </header><!-- Navigation -->
    <nav class="glass-card px-4 py-2 shadow">
     <div class="max-w-4xl mx-auto flex gap-6"><button onclick="showStudentSection('request')" class="nav-item py-2 font-medium text-gray-600 active" id="nav-request"> üìù ‡∏Ç‡∏≠‡∏•‡∏≤ </button> <button onclick="showStudentSection('history')" class="nav-item py-2 font-medium text-gray-600" id="nav-history"> üìã ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏•‡∏≤ </button>
     </div>
    </nav><!-- Content -->
    <main class="max-w-4xl mx-auto p-4"><!-- ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏•‡∏≤ -->
     <section id="section-request" class="fade-in">
      <div class="glass-card rounded-2xl p-6 shadow-xl">
       <h2 class="text-xl font-bold text-gray-800 mb-6 flex items-center gap-2"><span class="text-2xl">üìù</span> ‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡∏≠‡∏•‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô</h2>
       <form id="leave-form" onsubmit="submitLeaveRequest(event)" class="space-y-6"><!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô -->
        <div class="bg-purple-50 rounded-xl p-4">
         <h3 class="font-semibold text-purple-800 mb-3">üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div><label class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label> <input type="text" id="form-student-name" class="input-field w-full px-4 py-2 rounded-lg outline-none" required>
          </div>
          <div><label class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏±‡πâÔøΩÔøΩ/‡∏´‡πâ‡∏≠‡∏á</label> <input type="text" id="form-student-class" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏°.3/1" class="input-field w-full px-4 py-2 rounded-lg outline-none" required>
          </div>
         </div>
        </div><!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤ -->
        <div class="bg-blue-50 rounded-xl p-4">
         <h3 class="font-semibold text-blue-800 mb-3">üìÖ ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏≤</h3>
         <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div><label class="block text-sm font-medium text-gray-700 mb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏≤</label> <input type="date" id="form-leave-date" class="input-field w-full px-4 py-2 rounded-lg outline-none" required>
          </div>
          <div><label class="block text-sm font-medium text-gray-700 mb-1">‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</label> <input type="time" id="form-leave-time" class="input-field w-full px-4 py-2 rounded-lg outline-none" required>
          </div>
          <div><label class="block text-sm font-medium text-gray-700 mb-1">‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏•‡∏±‡∏ö (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label> <input type="time" id="form-return-time" class="input-field w-full px-4 py-2 rounded-lg outline-none">
          </div>
         </div>
         <div class="mt-4"><label class="block text-sm font-medium text-gray-700 mb-1">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏≤</label> <textarea id="form-reason" rows="3" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•..." class="input-field w-full px-4 py-2 rounded-lg outline-none resize-none" required></textarea>
         </div>
        </div><!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á -->
        <div class="bg-green-50 rounded-xl p-4">
         <h3 class="font-semibold text-green-800 mb-3">üë®‚Äçüë©‚Äçüëß ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏£‡∏±‡∏ö</h3>
         <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div><label class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</label> <input type="text" id="form-guardian-name" class="input-field w-full px-4 py-2 rounded-lg outline-none" required>
          </div>
          <div><label class="block text-sm font-medium text-gray-700 mb-1">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå</label> <select id="form-guardian-relation" class="input-field w-full px-4 py-2 rounded-lg outline-none" required> <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å...</option> <option value="‡∏ö‡∏¥‡∏î‡∏≤">‡∏ö‡∏¥‡∏î‡∏≤</option> <option value="‡∏°‡∏≤‡∏£‡∏î‡∏≤">‡∏°‡∏≤‡∏£‡∏î‡∏≤</option> <option value="‡∏õ‡∏π‡πà/‡∏¢‡πà‡∏≤">‡∏õ‡∏π‡πà/‡∏¢‡πà‡∏≤</option> <option value="‡∏ï‡∏≤/‡∏¢‡∏≤‡∏¢">‡∏ï‡∏≤/‡∏¢‡∏≤‡∏¢</option> <option value="‡∏ç‡∏≤‡∏ï‡∏¥">‡∏ç‡∏≤‡∏ï‡∏¥</option> <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option> </select>
          </div>
          <div><label class="block text-sm font-medium text-gray-700 mb-1">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label> <input type="tel" id="form-guardian-phone" placeholder="08x-xxx-xxxx" class="input-field w-full px-4 py-2 rounded-lg outline-none" required>
          </div>
         </div><!-- ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û -->
         <div class="mt-4"><label class="block text-sm font-medium text-gray-700 mb-2">üì∑ ‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏£‡∏±‡∏ö</label>
          <div id="image-upload-area" class="border-2 border-dashed border-gray-300 rounded-xl p-6 text-center cursor-pointer hover:border-purple-500 transition-all"><input type="file" id="form-guardian-image" accept="image/*" class="hidden" onchange="previewImage(event)">
           <div id="image-placeholder" onclick="document.getElementById('form-guardian-image').click()"><span class="text-4xl">üì∑</span>
            <p class="text-gray-500 mt-2">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</p>
            <p class="text-sm text-gray-400">‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
           </div>
           <div id="image-preview" class="hidden"><img id="preview-img" class="max-h-48 mx-auto rounded-lg shadow"> <button type="button" onclick="removeImage()" class="mt-2 text-red-500 text-sm hover:underline"> ‚ùå ‡∏•‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û </button>
           </div>
          </div>
         </div>
        </div><button type="submit" id="submit-btn" class="btn-primary w-full py-4 rounded-xl text-white font-semibold text-lg shadow-lg flex items-center justify-center gap-2"> <span>üì§</span> ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏•‡∏≤ </button>
       </form>
      </div>
     </section><!-- ‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ -->
     <section id="section-history" class="fade-in hidden">
      <div class="glass-card rounded-2xl p-6 shadow-xl">
       <h2 class="text-xl font-bold text-gray-800 mb-6 flex items-center gap-2"><span class="text-2xl">üìã</span> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h2>
       <div id="student-history-list" class="space-y-4"><!-- ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
       </div>
       <div id="student-history-empty" class="text-center py-12 text-gray-500 hidden"><span class="text-6xl">üì≠</span>
        <p class="mt-4 text-lg">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏•‡∏≤</p>
       </div>
      </div>
     </section>
    </main>
   </div><!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏Ñ‡∏£‡∏π/Admin -->
   <div id="admin-page" class="min-h-full hidden"><!-- Header -->
    <header class="glass-card sticky top-0 z-40 px-4 py-3 shadow-lg">
     <div class="max-w-6xl mx-auto flex items-center justify-between">
      <div class="flex items-center gap-3"><span class="text-2xl">üë®‚Äçüè´</span>
       <div>
        <p class="font-semibold text-gray-800" id="admin-welcome">‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô</p>
        <p class="text-sm text-gray-500">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏•‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô</p>
       </div>
      </div><button onclick="logout()" class="px-4 py-2 rounded-lg bg-red-100 text-red-600 font-medium hover:bg-red-200 transition-all"> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö </button>
     </div>
    </header><!-- Navigation -->
    <nav class="glass-card px-4 py-2 shadow">
     <div class="max-w-6xl mx-auto flex gap-6"><button onclick="showAdminSection('pending')" class="nav-item py-2 font-medium text-gray-600 active" id="admin-nav-pending"> üîî ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏Ç‡∏≠ <span id="pending-badge" class="ml-1 px-2 py-0.5 bg-red-500 text-white text-xs rounded-full hidden">0</span> </button> <button onclick="showAdminSection('all')" class="nav-item py-2 font-medium text-gray-600" id="admin-nav-all"> üìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î </button>
     </div>
    </nav><!-- Content -->
    <main class="max-w-6xl mx-auto p-4"><!-- ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ -->
     <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
      <div class="glass-card rounded-xl p-4 text-center card-hover"><span class="text-3xl">üìã</span>
       <p class="text-2xl font-bold text-gray-800 mt-2" id="stat-total">0</p>
       <p class="text-sm text-gray-500">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
      </div>
      <div class="glass-card rounded-xl p-4 text-center card-hover"><span class="text-3xl">‚è≥</span>
       <p class="text-2xl font-bold text-yellow-600 mt-2" id="stat-pending">0</p>
       <p class="text-sm text-gray-500">‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</p>
      </div>
      <div class="glass-card rounded-xl p-4 text-center card-hover"><span class="text-3xl">‚úÖ</span>
       <p class="text-2xl font-bold text-green-600 mt-2" id="stat-approved">0</p>
       <p class="text-sm text-gray-500">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</p>
      </div>
      <div class="glass-card rounded-xl p-4 text-center card-hover"><span class="text-3xl">‚ùå</span>
       <p class="text-2xl font-bold text-red-600 mt-2" id="stat-rejected">0</p>
       <p class="text-sm text-gray-500">‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>
      </div>
     </div><!-- ‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö -->
     <section id="admin-section-pending" class="fade-in">
      <div class="glass-card rounded-2xl p-6 shadow-xl">
       <h2 class="text-xl font-bold text-gray-800 mb-6 flex items-center gap-2"><span class="text-2xl">üîî</span> ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</h2>
       <div id="pending-list" class="space-y-4"><!-- ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
       </div>
       <div id="pending-empty" class="text-center py-12 text-gray-500 hidden"><span class="text-6xl">‚ú®</span>
        <p class="mt-4 text-lg">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</p>
       </div>
      </div>
     </section><!-- ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î -->
     <section id="admin-section-all" class="fade-in hidden">
      <div class="glass-card rounded-2xl p-6 shadow-xl">
       <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
        <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2"><span class="text-2xl">üìä</span> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
        <div class="flex gap-2"><input type="text" id="search-input" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠/‡∏£‡∏´‡∏±‡∏™..." class="input-field px-4 py-2 rounded-lg outline-none" onkeyup="filterAllRecords()"> <select id="filter-status" class="input-field px-4 py-2 rounded-lg outline-none" onchange="filterAllRecords()"> <option value="all">‡∏ó‡∏∏‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</option> <option value="pending">‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</option> <option value="approved">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</option> <option value="rejected">‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</option> </select>
        </div>
       </div>
       <div id="all-records-list" class="space-y-4"><!-- ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
       </div>
       <div id="all-records-empty" class="text-center py-12 text-gray-500 hidden"><span class="text-6xl">üì≠</span>
        <p class="mt-4 text-lg">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤</p>
       </div>
      </div>
     </section>
    </main>
   </div><!-- Modal ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î -->
   <div id="detail-modal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeDetailModal()"></div>
    <div class="absolute inset-4 md:inset-10 overflow-auto">
     <div class="glass-card rounded-2xl p-6 max-w-2xl mx-auto my-4 relative"><button onclick="closeDetailModal()" class="absolute top-4 right-4 w-10 h-10 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center"> ‚úï </button>
      <div id="detail-content"><!-- ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
      </div>
     </div>
    </div>
   </div><!-- Modal ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ -->
   <div id="reject-modal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeRejectModal()"></div>
    <div class="absolute inset-4 flex items-center justify-center">
     <div class="glass-card rounded-2xl p-6 w-full max-w-md">
      <h3 class="text-xl font-bold text-gray-800 mb-4">‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ñ‡∏≥‡∏Ç‡∏≠</h3><textarea id="reject-note" rows="4" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥..." class="input-field w-full px-4 py-3 rounded-xl outline-none resize-none mb-4"></textarea>
      <div class="flex gap-3"><button onclick="closeRejectModal()" class="flex-1 py-3 rounded-xl bg-gray-200 font-medium hover:bg-gray-300 transition-all"> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å </button> <button onclick="confirmReject()" class="flex-1 py-3 rounded-xl btn-danger text-white font-medium"> ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ </button>
      </div>
     </div>
    </div>
   </div>
  </div>
  <script>
    // ==================== State Management ====================
    let allRecords = [];
    let currentUser = null;
    let currentUserType = null; // 'student' or 'admin'
    let selectedRecordId = null;
    let guardianImageData = null;

    // ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ñ‡∏£‡∏π/admin (‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏£‡∏¥‡∏á‡∏Ñ‡∏ß‡∏£‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô database)
    const adminAccounts = [
      { username: 'admin', password: '1234', name: '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö' },
      { username: 'teacher1', password: '1234', name: '‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏π‡∏™‡∏°‡∏®‡∏£‡∏µ' },
      { username: 'teacher2', password: '1234', name: '‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏π‡∏™‡∏°‡∏ä‡∏≤‡∏¢' }
    ];

    // Default Config
    const defaultConfig = {
      school_name: '‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á',
      system_title: '‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ß‡∏±‡∏ô',
      primary_color: '#667eea',
      secondary_color: '#764ba2',
      text_color: '#1f2937',
      bg_color: '#f3f4f6',
      accent_color: '#10b981'
    };

    let config = { ...defaultConfig };

    // ==================== SDK Initialization ====================
    const dataHandler = {
      onDataChanged(data) {
        allRecords = data || [];
        updateUI();
      }
    };

    async function initApp() {
      // Initialize Element SDK
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange: async (newConfig) => {
            config = { ...defaultConfig, ...newConfig };
            applyConfig();
          },
          mapToCapabilities: (cfg) => ({
            recolorables: [
              {
                get: () => cfg.primary_color || defaultConfig.primary_color,
                set: (v) => { cfg.primary_color = v; window.elementSdk.setConfig({ primary_color: v }); }
              },
              {
                get: () => cfg.secondary_color || defaultConfig.secondary_color,
                set: (v) => { cfg.secondary_color = v; window.elementSdk.setConfig({ secondary_color: v }); }
              },
              {
                get: () => cfg.text_color || defaultConfig.text_color,
                set: (v) => { cfg.text_color = v; window.elementSdk.setConfig({ text_color: v }); }
              },
              {
                get: () => cfg.bg_color || defaultConfig.bg_color,
                set: (v) => { cfg.bg_color = v; window.elementSdk.setConfig({ bg_color: v }); }
              },
              {
                get: () => cfg.accent_color || defaultConfig.accent_color,
                set: (v) => { cfg.accent_color = v; window.elementSdk.setConfig({ accent_color: v }); }
              }
            ],
            borderables: [],
            fontEditable: undefined,
            fontSizeable: undefined
          }),
          mapToEditPanelValues: (cfg) => new Map([
            ['school_name', cfg.school_name || defaultConfig.school_name],
            ['system_title', cfg.system_title || defaultConfig.system_title]
          ])
        });
      }

      // Initialize Data SDK
      if (window.dataSdk) {
        const result = await window.dataSdk.init(dataHandler);
        if (!result.isOk) {
          console.error('Failed to initialize data SDK');
        }
      }

      // Set default date
      document.getElementById('form-leave-date').valueAsDate = new Date();
      
      applyConfig();
    }

    function applyConfig() {
      const schoolName = config.school_name || defaultConfig.school_name;
      const systemTitle = config.system_title || defaultConfig.system_title;
      
      document.getElementById('school-name-display').textContent = schoolName;
      document.getElementById('system-title-display').textContent = systemTitle;
    }

    // ==================== Authentication ====================
    function switchLoginTab(type) {
      const studentTab = document.getElementById('tab-student');
      const teacherTab = document.getElementById('tab-teacher');
      const studentForm = document.getElementById('student-login-form');
      const teacherForm = document.getElementById('teacher-login-form');

      if (type === 'student') {
        studentTab.className = 'flex-1 py-3 rounded-lg font-medium transition-all bg-white shadow text-purple-600';
        teacherTab.className = 'flex-1 py-3 rounded-lg font-medium transition-all text-gray-500';
        studentForm.classList.remove('hidden');
        teacherForm.classList.add('hidden');
      } else {
        teacherTab.className = 'flex-1 py-3 rounded-lg font-medium transition-all bg-white shadow text-purple-600';
        studentTab.className = 'flex-1 py-3 rounded-lg font-medium transition-all text-gray-500';
        teacherForm.classList.remove('hidden');
        studentForm.classList.add('hidden');
      }
    }

    function handleStudentLogin(e) {
      e.preventDefault();
      const studentId = document.getElementById('student-id-input').value.trim();
      const idCard = document.getElementById('student-id-card').value.trim();

      if (studentId.length < 3) {
        showLoginError('student', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
        return;
      }
      if (idCard.length !== 4) {
        showLoginError('student', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô 4 ‡∏ï‡∏±‡∏ß‡∏ó‡πâ‡∏≤‡∏¢');
        return;
      }

      currentUser = { studentId, idCard };
      currentUserType = 'student';
      
      document.getElementById('login-page').classList.add('hidden');
      document.getElementById('student-page').classList.remove('hidden');
      document.getElementById('student-welcome').textContent = `‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô`;
      document.getElementById('student-id-display').textContent = `‡∏£‡∏´‡∏±‡∏™: ${studentId}`;
      
      showToast('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‚úÖ');
      updateUI();
    }

    function handleTeacherLogin(e) {
      e.preventDefault();
      const username = document.getElementById('teacher-username').value.trim();
      const password = document.getElementById('teacher-password').value;

      const account = adminAccounts.find(a => a.username === username && a.password === password);
      
      if (!account) {
        showLoginError('teacher', '‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
        return;
      }

      currentUser = account;
      currentUserType = 'admin';
      
      document.getElementById('login-page').classList.add('hidden');
      document.getElementById('admin-page').classList.remove('hidden');
      document.getElementById('admin-welcome').textContent = `‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ ${account.name}`;
      
      showToast('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‚úÖ');
      updateUI();
    }

    function showLoginError(type, message) {
      const errorEl = document.getElementById(`${type}-login-error`);
      errorEl.textContent = message;
      errorEl.classList.remove('hidden');
      setTimeout(() => errorEl.classList.add('hidden'), 3000);
    }

    function logout() {
      currentUser = null;
      currentUserType = null;
      guardianImageData = null;
      
      document.getElementById('login-page').classList.remove('hidden');
      document.getElementById('student-page').classList.add('hidden');
      document.getElementById('admin-page').classList.add('hidden');
      
      // Reset forms
      document.getElementById('student-login-form').reset();
      document.getElementById('teacher-login-form').reset();
      document.getElementById('leave-form').reset();
      document.getElementById('form-leave-date').valueAsDate = new Date();
      removeImage();
      
      showToast('‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß', 'üëã');
    }

    // ==================== Navigation ====================
    function showStudentSection(section) {
      document.querySelectorAll('[id^="section-"]').forEach(el => el.classList.add('hidden'));
      document.getElementById(`section-${section}`).classList.remove('hidden');
      
      document.querySelectorAll('[id^="nav-"]').forEach(el => el.classList.remove('active'));
      document.getElementById(`nav-${section}`).classList.add('active');
    }

    function showAdminSection(section) {
      document.querySelectorAll('[id^="admin-section-"]').forEach(el => el.classList.add('hidden'));
      document.getElementById(`admin-section-${section}`).classList.remove('hidden');
      
      document.querySelectorAll('[id^="admin-nav-"]').forEach(el => el.classList.remove('active'));
      document.getElementById(`admin-nav-${section}`).classList.add('active');
    }

    // ==================== Leave Request ====================
    function previewImage(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(event) {
          guardianImageData = event.target.result;
          document.getElementById('preview-img').src = guardianImageData;
          document.getElementById('image-placeholder').classList.add('hidden');
          document.getElementById('image-preview').classList.remove('hidden');
        };
        reader.readAsDataURL(file);
      }
    }

    function removeImage() {
      guardianImageData = null;
      document.getElementById('form-guardian-image').value = '';
      document.getElementById('image-placeholder').classList.remove('hidden');
      document.getElementById('image-preview').classList.add('hidden');
    }

    async function submitLeaveRequest(e) {
      e.preventDefault();
      
      if (!currentUser || currentUserType !== 'student') {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô', '‚ö†Ô∏è');
        return;
      }

      // Check if Data SDK is ready
      if (!window.dataSdk) {
        showToast('‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏° ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà', '‚ö†Ô∏è');
        return;
      }

      // Check limit
      if (allRecords.length >= 999) {
        showToast('‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ï‡πá‡∏° ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ', '‚ö†Ô∏è');
        return;
      }

      const submitBtn = document.getElementById('submit-btn');
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<span class="animate-spin">‚è≥</span> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...';

      try {
        const newRequest = {
          student_id: currentUser.studentId,
          student_name: document.getElementById('form-student-name').value.trim(),
          student_class: document.getElementById('form-student-class').value.trim(),
          leave_date: document.getElementById('form-leave-date').value,
          leave_time: document.getElementById('form-leave-time').value,
          return_time: document.getElementById('form-return-time').value || '',
          reason: document.getElementById('form-reason').value.trim(),
          guardian_name: document.getElementById('form-guardian-name').value.trim(),
          guardian_relation: document.getElementById('form-guardian-relation').value,
          guardian_phone: document.getElementById('form-guardian-phone').value.trim(),
          guardian_image: guardianImageData || '',
          status: 'pending',
          reject_note: '',
          approved_by: '',
          approved_at: '',
          created_at: new Date().toISOString()
        };

        // Set timeout for the operation
        const timeoutPromise = new Promise((_, reject) => 
          setTimeout(() => reject(new Error('timeout')), 10000)
        );

        const result = await Promise.race([
          window.dataSdk.create(newRequest),
          timeoutPromise
        ]);

        if (result.isOk) {
          showToast('‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏•‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', '‚úÖ');
          document.getElementById('leave-form').reset();
          document.getElementById('form-leave-date').valueAsDate = new Date();
          removeImage();
          showStudentSection('history');
        } else {
          showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + (result.error?.message || '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà'), '‚ùå');
        }
      } catch (error) {
        console.error('Submit error:', error);
        if (error.message === 'timeout') {
          showToast('‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', '‚è±Ô∏è');
        } else {
          showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà', '‚ùå');
        }
      } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<span>üì§</span> ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏•‡∏≤';
      }
    }

    // ==================== Admin Actions ====================
    async function approveRequest(recordId) {
      const record = allRecords.find(r => r.__backendId === recordId);
      if (!record) return;

      const updatedRecord = {
        ...record,
        status: 'approved',
        approved_by: currentUser.name,
        approved_at: new Date().toISOString()
      };

      const result = await window.dataSdk.update(updatedRecord);
      if (result.isOk) {
        showToast('‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', '‚úÖ');
        closeDetailModal();
      } else {
        showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‚ùå');
      }
    }

    function openRejectModal(recordId) {
      selectedRecordId = recordId;
      document.getElementById('reject-note').value = '';
      document.getElementById('reject-modal').classList.remove('hidden');
    }

    function closeRejectModal() {
      selectedRecordId = null;
      document.getElementById('reject-modal').classList.add('hidden');
    }

    async function confirmReject() {
      if (!selectedRecordId) return;

      const record = allRecords.find(r => r.__backendId === selectedRecordId);
      if (!record) return;

      const rejectNote = document.getElementById('reject-note').value.trim();
      if (!rejectNote) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•', '‚ö†Ô∏è');
        return;
      }

      const updatedRecord = {
        ...record,
        status: 'rejected',
        reject_note: rejectNote,
        approved_by: currentUser.name,
        approved_at: new Date().toISOString()
      };

      const result = await window.dataSdk.update(updatedRecord);
      if (result.isOk) {
        showToast('‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', '‚ùå');
        closeRejectModal();
        closeDetailModal();
      } else {
        showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‚ùå');
      }
    }

    async function deleteRecord(recordId) {
      const record = allRecords.find(r => r.__backendId === recordId);
      if (!record) return;

      const result = await window.dataSdk.delete(record);
      if (result.isOk) {
        showToast('‡∏•‡∏ö‡∏ÇÔøΩÔøΩ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'üóëÔ∏è');
        closeDetailModal();
      } else {
        showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‚ùå');
      }
    }

    // ==================== UI Updates ====================
    function updateUI() {
      if (currentUserType === 'student') {
        updateStudentHistory();
      } else if (currentUserType === 'admin') {
        updateAdminUI();
      }
    }

    function updateStudentHistory() {
      const myRecords = allRecords.filter(r => r.student_id === currentUser.studentId)
        .sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
      
      const listEl = document.getElementById('student-history-list');
      const emptyEl = document.getElementById('student-history-empty');

      if (myRecords.length === 0) {
        listEl.innerHTML = '';
        emptyEl.classList.remove('hidden');
        return;
      }

      emptyEl.classList.add('hidden');
      listEl.innerHTML = myRecords.map(record => `
        <div class="bg-white rounded-xl p-4 shadow-md card-hover cursor-pointer" onclick="showDetailModal('${record.__backendId}')">
          <div class="flex items-start justify-between">
            <div>
              <div class="flex items-center gap-2 mb-2">
                ${getStatusBadge(record.status)}
                <span class="text-gray-500 text-sm">${formatDate(record.leave_date)}</span>
              </div>
              <p class="font-medium text-gray-800">${record.reason}</p>
              <p class="text-sm text-gray-500 mt-1">‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å: ${record.leave_time} ‡∏ô.</p>
            </div>
            <span class="text-2xl">${getStatusIcon(record.status)}</span>
          </div>
          ${record.status === 'rejected' && record.reject_note ? `
            <div class="mt-3 p-3 bg-red-50 rounded-lg">
              <p class="text-sm text-red-600"><strong>‡∏´‡∏°‡∏≤ÔøΩÔøΩ‡πÄ‡∏´‡∏ï‡∏∏:</strong> ${record.reject_note}</p>
            </div>
          ` : ''}
        </div>
      `).join('');
    }

    function updateAdminUI() {
      // Update stats
      const pending = allRecords.filter(r => r.status === 'pending');
      const approved = allRecords.filter(r => r.status === 'approved');
      const rejected = allRecords.filter(r => r.status === 'rejected');

      document.getElementById('stat-total').textContent = allRecords.length;
      document.getElementById('stat-pending').textContent = pending.length;
      document.getElementById('stat-approved').textContent = approved.length;
      document.getElementById('stat-rejected').textContent = rejected.length;

      // Update pending badge
      const badge = document.getElementById('pending-badge');
      if (pending.length > 0) {
        badge.textContent = pending.length;
        badge.classList.remove('hidden');
      } else {
        badge.classList.add('hidden');
      }

      // Update pending list
      updatePendingList(pending);
      
      // Update all records
      filterAllRecords();
    }

    function updatePendingList(pending) {
      const listEl = document.getElementById('pending-list');
      const emptyEl = document.getElementById('pending-empty');

      if (pending.length === 0) {
        listEl.innerHTML = '';
        emptyEl.classList.remove('hidden');
        return;
      }

      emptyEl.classList.add('hidden');
      listEl.innerHTML = pending.sort((a, b) => new Date(b.created_at) - new Date(a.created_at))
        .map(record => createRecordCard(record, true)).join('');
    }

    function filterAllRecords() {
      const searchTerm = document.getElementById('search-input').value.toLowerCase();
      const statusFilter = document.getElementById('filter-status').value;

      let filtered = allRecords;

      if (statusFilter !== 'all') {
        filtered = filtered.filter(r => r.status === statusFilter);
      }

      if (searchTerm) {
        filtered = filtered.filter(r => 
          r.student_name.toLowerCase().includes(searchTerm) ||
          r.student_id.includes(searchTerm)
        );
      }

      const listEl = document.getElementById('all-records-list');
      const emptyEl = document.getElementById('all-records-empty');

      if (filtered.length === 0) {
        listEl.innerHTML = '';
        emptyEl.classList.remove('hidden');
        return;
      }

      emptyEl.classList.add('hidden');
      listEl.innerHTML = filtered.sort((a, b) => new Date(b.created_at) - new Date(a.created_at))
        .map(record => createRecordCard(record, false)).join('');
    }

    function createRecordCard(record, showActions) {
      return `
        <div class="bg-white rounded-xl p-4 shadow-md card-hover">
          <div class="flex items-start justify-between">
            <div class="flex-1" onclick="showDetailModal('${record.__backendId}')" style="cursor: pointer;">
              <div class="flex items-center gap-2 mb-2">
                ${getStatusBadge(record.status)}
                <span class="text-gray-500 text-sm">${formatDate(record.leave_date)}</span>
              </div>
              <p class="font-semibold text-gray-800">${record.student_name}</p>
              <p class="text-sm text-gray-500">‡∏£‡∏´‡∏±‡∏™: ${record.student_id} | ‡∏ä‡∏±‡πâ‡∏ô: ${record.student_class}</p>
              <p class="text-sm text-gray-600 mt-1">üìù ${record.reason}</p>
            </div>
            ${showActions ? `
              <div class="flex gap-2 ml-4">
                <button onclick="approveRequest('${record.__backendId}')" 
                  class="px-4 py-2 rounded-lg btn-success text-white font-medium text-sm hover:opacity-90">
                  ‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                </button>
                <button onclick="openRejectModal('${record.__backendId}')" 
                  class="px-4 py-2 rounded-lg btn-danger text-white font-medium text-sm hover:opacity-90">
                  ‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                </button>
              </div>
            ` : ''}
          </div>
        </div>
      `;
    }

    // ==================== Detail Modal ====================
    function showDetailModal(recordId) {
      const record = allRecords.find(r => r.__backendId === recordId);
      if (!record) return;

      const content = document.getElementById('detail-content');
      content.innerHTML = `
        <div class="text-center mb-6">
          <h3 class="text-xl font-bold text-gray-800">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏•‡∏≤</h3>
          <div class="mt-2">${getStatusBadge(record.status)}</div>
        </div>

        <div class="space-y-4">
          <div class="bg-purple-50 rounded-xl p-4">
            <h4 class="font-semibold text-purple-800 mb-3">üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h4>
            <div class="grid grid-cols-2 gap-3 text-sm">
              <p><span class="text-gray-500">‡∏ä‡∏∑‡πà‡∏≠:</span> ${record.student_name}</p>
              <p><span class="text-gray-500">‡∏£‡∏´‡∏±‡∏™:</span> ${record.student_id}</p>
              <p><span class="text-gray-500">‡∏ä‡∏±‡πâ‡∏ô:</span> ${record.student_class}</p>
            </div>
          </div>

          <div class="bg-blue-50 rounded-xl p-4">
            <h4 class="font-semibold text-blue-800 mb-3">üìÖ ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏≤</h4>
            <div class="grid grid-cols-2 gap-3 text-sm">
              <p><span class="text-gray-500">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</span> ${formatDate(record.leave_date)}</p>
              <p><span class="text-gray-500">‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å:</span> ${record.leave_time} ‡∏ô.</p>
              ${record.return_time ? `<p><span class="text-gray-500">‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏•‡∏±‡∏ö:</span> ${record.return_time} ‡∏ô.</p>` : ''}
            </div>
            <p class="mt-2 text-sm"><span class="text-gray-500">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•:</span> ${record.reason}</p>
          </div>

          <div class="bg-green-50 rounded-xl p-4">
            <h4 class="font-semibold text-green-800 mb-3">üë®‚Äçüë©‚Äçüëß ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</h4>
            <div class="grid grid-cols-2 gap-3 text-sm">
              <p><span class="text-gray-500">‡∏ä‡∏∑‡πà‡∏≠:</span> ${record.guardian_name}</p>
              <p><span class="text-gray-500">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå:</span> ${record.guardian_relation}</p>
              <p><span class="text-gray-500">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:</span> ${record.guardian_phone}</p>
            </div>
            ${record.guardian_image ? `
              <div class="mt-3">
                <p class="text-sm text-gray-500 mb-2">üì∑ ‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á:</p>
                <img src="${record.guardian_image}" class="max-h-48 rounded-lg shadow">
              </div>
            ` : ''}
          </div>

          ${record.status !== 'pending' ? `
            <div class="${record.status === 'approved' ? 'bg-green-50' : 'bg-red-50'} rounded-xl p-4">
              <h4 class="font-semibold ${record.status === 'approved' ? 'text-green-800' : 'text-red-800'} mb-3">
                ${record.status === 'approved' ? '‚úÖ ‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥' : '‚ùå ‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥'}
              </h4>
              <div class="text-sm">
                <p><span class="text-gray-500">‡πÇ‡∏î‡∏¢:</span> ${record.approved_by}</p>
                <p><span class="text-gray-500">‡πÄ‡∏°‡∏∑‡πà‡∏≠:</span> ${formatDateTime(record.approved_at)}</p>
                ${record.reject_note ? `<p class="mt-2"><span class="text-gray-500">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</span> ${record.reject_note}</p>` : ''}
              </div>
            </div>
          ` : ''}
        </div>

        ${currentUserType === 'admin' ? `
          <div class="flex gap-3 mt-6">
            ${record.status === 'pending' ? `
              <button onclick="approveRequest('${record.__backendId}')" 
                class="flex-1 py-3 rounded-xl btn-success text-white font-medium">
                ‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
              </button>
              <button onclick="openRejectModal('${record.__backendId}')" 
                class="flex-1 py-3 rounded-xl btn-danger text-white font-medium">
                ‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
              </button>
            ` : `
              <button onclick="deleteRecord('${record.__backendId}')" 
                class="flex-1 py-3 rounded-xl bg-gray-200 text-gray-700 font-medium hover:bg-gray-300">
                üóëÔ∏è ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
              </button>
            `}
          </div>
        ` : ''}
      `;

      document.getElementById('detail-modal').classList.remove('hidden');
    }

    function closeDetailModal() {
      document.getElementById('detail-modal').classList.add('hidden');
    }

    // ==================== Utilities ====================
    function getStatusBadge(status) {
      const badges = {
        pending: '<span class="px-3 py-1 rounded-full text-xs font-medium text-white status-pending">‚è≥ ‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</span>',
        approved: '<span class="px-3 py-1 rounded-full text-xs font-medium text-white status-approved">‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</span>',
        rejected: '<span class="px-3 py-1 rounded-full text-xs font-medium text-white status-rejected">‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</span>'
      };
      return badges[status] || badges.pending;
    }

    function getStatusIcon(status) {
      const icons = { pending: '‚è≥', approved: '‚úÖ', rejected: '‚ùå' };
      return icons[status] || '‚è≥';
    }

    function formatDate(dateStr) {
      if (!dateStr) return '-';
      const date = new Date(dateStr);
      return date.toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' });
    }

    function formatDateTime(dateStr) {
      if (!dateStr) return '-';
      const date = new Date(dateStr);
      return date.toLocaleDateString('th-TH', { 
        year: 'numeric', month: 'long', day: 'numeric',
        hour: '2-digit', minute: '2-digit'
      });
    }

    function showToast(message, icon = '‚úÖ') {
      const toast = document.getElementById('toast');
      document.getElementById('toast-message').textContent = message;
      document.getElementById('toast-icon').textContent = icon;
      toast.classList.remove('hidden');
      setTimeout(() => toast.classList.add('hidden'), 3000);
    }

    // Initialize on load
    initApp();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9c0e8c89f5ff7334',t:'MTc2ODkxMTg2OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
